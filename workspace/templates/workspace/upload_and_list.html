{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2>ğŸ“¤ íŒŒì¼ ë° í´ë” ì—…ë¡œë“œ</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <p>ğŸ“ í´ë” ì—…ë¡œë“œ:</p>
    <input type="file" name="files" webkitdirectory directory multiple><br><br>

    <p>ğŸ“„ íŒŒì¼ ì—…ë¡œë“œ:</p>
    <input type="file" name="files" multiple><br><br>

    <label>ì»¤ë°‹ ë©”ì‹œì§€ (ì„ íƒ):</label><br>
    <input type="text" name="message" placeholder="ë³€ê²½ì‚¬í•­ ì„¤ëª…"><br><br>

    <input type="checkbox" name="git" id="git">
    <label for="git">Gitìœ¼ë¡œ ë²„ì „ ê´€ë¦¬</label><br><br>

    <button type="submit">ì—…ë¡œë“œ</button>
</form>

<hr>

<h2>ğŸ“ ì¼ë°˜ ì—…ë¡œë“œ íŒŒì¼</h2>
<ul>
    {% for file in files %}
        {% if not file.git_tracked %}
        <li>
            <a href="{{ file.file.url }}">{{ file.filepath }}</a>
            ({{ file.uploaded_at|date:"Y-m-d H:i" }})

            <!-- ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ -->
            {% if ".png" in file.file.url or ".jpg" in file.file.url or ".jpeg" in file.file.url %}
                <div><img src="{{ file.file.url }}" width="150"></div>
            {% elif ".txt" in file.file.url or ".py" in file.file.url or ".md" in file.file.url %}
                <details><summary>í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°</summary>
                    <iframe src="{{ file.file.url }}" width="600" height="200"></iframe>
                </details>
            {% elif ".pdf" in file.file.url %}
                <details><summary>PDF ë¯¸ë¦¬ë³´ê¸°</summary>
                    <iframe src="{{ file.file.url }}" width="600" height="300"></iframe>
                </details>
            {% elif ".xlsx" in file.file.url or ".docx" in file.file.url or ".ppt" in file.file.url or ".pptx" in file.file.url %}
                <details><summary>Office ë¬¸ì„œ ë¯¸ë¦¬ë³´ê¸°</summary>
                    <iframe src="https://view.officeapps.live.com/op/embed.aspx?src={{ request.build_absolute_uri|urlencode:file.file.url }}" width="700" height="400" frameborder="0"></iframe>
                </details>
            {% endif %}

            <form action="{% url 'delete_file' file.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?');">ì‚­ì œ</button>
            </form>
        </li>
        {% endif %}
    {% endfor %}
</ul>

<h2>ğŸ§  Gitìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ” íŒŒì¼</h2>
<ul>
    {% for file in files %}
        {% if file.git_tracked %}
        <li>
            <a href="{{ file.file.url }}">{{ file.filepath }}</a>
            ({{ file.uploaded_at|date:"Y-m-d H:i" }})

            <form action="{% url 'delete_file' file.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?');">ì‚­ì œ</button>
            </form>
        </li>
        {% endif %}
    {% endfor %}
</ul>

<h3>ğŸ“ ì¼ë°˜ íŒŒì¼ ë¡œê·¸</h3>
<ul>
    {% for log in logs %}
        <li>{{ log.timestamp|date:"Y-m-d H:i" }} - {{ log.action }} - {{ log.filename }}</li>
    {% endfor %}
</ul>

{% endblock %}
